<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5. JPA, JSF を組み合わせたデータ操作 &mdash; WebAppTraining 1.0 ドキュメント</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="WebAppTraining 1.0 ドキュメント" href="index.html" />
    <link rel="next" title="6. データバリデーション" href="06_Validation.html" />
    <link rel="prev" title="4. JSF を用いた画面表示" href="04_JSF.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="06_Validation.html" title="6. データバリデーション"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="04_JSF.html" title="4. JSF を用いた画面表示"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">WebAppTraining 1.0 ドキュメント</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. JPA, JSF を組み合わせたデータ操作</a><ul>
<li><a class="reference internal" href="#id1">5.1. ソースコードの修正</a><ul>
<li><a class="reference internal" href="#id2">5.1.1. 新規追加するソースコード</a><ul>
<li><a class="reference internal" href="#abstractoperation-java">5.1.1.1. AbstractOperation.java の作成</a></li>
<li><a class="reference internal" href="#employeeoperation-java">5.1.1.2. EmployeeOperation.java の作成</a></li>
<li><a class="reference internal" href="#rolemasteroperation-java">5.1.1.3. RoleMasterOperation.java の作成</a></li>
<li><a class="reference internal" href="#resources-java">5.1.1.4. Resources.java の作成</a></li>
<li><a class="reference internal" href="#sha256encoder-java">5.1.1.5. SHA256Encoder.java の作成</a></li>
<li><a class="reference internal" href="#abstractcontroller-java">5.1.1.6. AbstractController.java の作成</a></li>
<li><a class="reference internal" href="#shaindata-java">5.1.1.7. ShainData.java の作成</a></li>
<li><a class="reference internal" href="#shainpassword-java">5.1.1.8. ShainPassword.java の作成</a></li>
<li><a class="reference internal" href="#shaindata-xhtml">5.1.1.9. 社員データ編集画面 (shainData.xhtml) の作成</a></li>
<li><a class="reference internal" href="#shainpassword-xhtml">5.1.1.10. 社員パスワード変更画面 (shainPassword.xhtml) の作成</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">5.1.2. 修正するソースコード</a><ul>
<li><a class="reference internal" href="#shainlist-xhtml">5.1.2.1. 社員一覧画面 (shainList.xhtml) の修正</a></li>
<li><a class="reference internal" href="#shainlist-java">5.1.2.2. ShainList.java の修正</a></li>
<li><a class="reference internal" href="#employee-java">5.1.2.3. Employee.java の修正</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id4">5.2. データの挿入</a></li>
<li><a class="reference internal" href="#id5">5.3. データの更新</a></li>
<li><a class="reference internal" href="#id6">5.4. データの削除</a></li>
<li><a class="reference internal" href="#id7">5.5. まとめ</a></li>
<li><a class="reference internal" href="#id8">5.6. 確認してください</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="04_JSF.html"
                        title="前の章へ">4. JSF を用いた画面表示</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="06_Validation.html"
                        title="次の章へ">6. データバリデーション</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/05_JPAJSF.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="jpa-jsf">
<h1>5. JPA, JSF を組み合わせたデータ操作<a class="headerlink" href="#jpa-jsf" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Java Persistence API を用いてデータ操作を行い、DB に対してデータを CRUD (Create, Read, Update, Delete) できるようにします。
データ項目は、画面から行います。</p>
<div class="section" id="id1">
<h2>5.1. ソースコードの修正<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>まず、以下のソースコードを新規追加します。</p>
<ul class="simple">
<li>AbstractOperation.java</li>
<li>EmployeeOperation.java</li>
<li>RoleMasterOperation.java</li>
<li>Resources.java</li>
<li>SHA256Encoder.java</li>
<li>AbstractController.java</li>
<li>ShainData.java</li>
<li>ShainPassword.java</li>
<li>shainData.xhtml</li>
<li>shainPassword.xhtml</li>
</ul>
<p>さらに、以下のソースコードを修正します。</p>
<ul class="simple">
<li>shainList.xhtml</li>
<li>ShainList.java</li>
<li>Employee.java</li>
<li>RoleMaster.java</li>
</ul>
<div class="section" id="id2">
<h3>5.1.1. 新規追加するソースコード<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="abstractoperation-java">
<h4>5.1.1.1. AbstractOperation.java の作成<a class="headerlink" href="#abstractoperation-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>com.javadera.shainweb.service パッケージ配下に AbstractOperation クラスを作成してください。作成後、ソースコードを以下のように修正してください。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.service;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

/**
 * データ操作を行うための基底クラス
 *
 */
public abstract class AbstractOperation {
   @PersistenceContext(unitName=&quot;primary&quot;)
   protected EntityManager em;
}
</pre></div>
</div>
<p>データの操作には、EntityManager インターフェイスを用いて行います。EntityManager はアプリケーションサーバから DI されるため、開発者が new するものではありません。
このコードでは、persistence.xml で定義された persistence-unit 名 (&#8220;primary&#8221;) の EntityManager を DI しています。</p>
</div>
<div class="section" id="employeeoperation-java">
<h4>5.1.1.2. EmployeeOperation.java の作成<a class="headerlink" href="#employeeoperation-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>AbstractOperation クラスと同じパッケージに EmployeeOperation クラスを作成してください。作成後、ソースコードを以下のように修正してください。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.service;

import java.util.Date;
import java.util.List;

import javax.ejb.Stateless;
import javax.persistence.Query;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.CriteriaUpdate;
import javax.persistence.criteria.Root;

import com.javadera.shainweb.model.Employee;
import com.javadera.shainweb.model.Employee_;
import com.javadera.shainweb.model.RoleMaster;

/**
 * Employee テーブルの操作を行うクラス
 *
 */
@Stateless
public class EmployeeOperation extends AbstractOperation {

    /**
     * Employee を挿入します。
     * @param emp
     */
    public void addEmployee(Employee emp) {
        em.persist(emp);
    }

    /**
     * Employee を削除します。
     * @param emp
     */
    public void removeEmployee(Employee emp) {
        Employee target = em.merge(emp);
        em.remove(target);
    }

    /**
     * Employee を更新します。
     * @param emp
     * @return
     */
    public Employee updateEmployee(Employee emp) {
        Employee target = em.merge(emp);
        em.flush();
        return target;
    }

    /**
     * ID を指定して Employee を取得します。
     * @param id
     * @return
     */
    public Employee getEmployeeById(String shainId) {
        Query q = em.createNamedQuery(&quot;Employee.findById&quot;);
        q.setParameter(&quot;shainId&quot;, shainId);
        return (Employee)q.getSingleResult();
    }

   /**
    * ID を指定して Employee を取得します。
    * (Criteria Query を用いた手法)
    * @param id
    * @return
    */
   public Employee getEmployeeByIdCriteria(String shainId) {
       CriteriaBuilder cb = em.getCriteriaBuilder();
       CriteriaQuery&lt;Employee&gt; criteria = cb.createQuery(Employee.class);
       Root&lt;Employee&gt; empRoot = criteria.from(Employee.class);
       criteria.select(empRoot).where(cb.equal(empRoot.get(Employee_.shainId), shainId));
       return em.createQuery(criteria).getSingleResult();
   }

    /**
     * ID 順に Employee 一覧を取得します。
     * @return
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public List&lt;Employee&gt; getEmployeeList() {
        Query q = em.createNamedQuery(&quot;Employee.findAllOrderById&quot;);
        return q.getResultList();
    }

    /**
     * ID 順に Employee 一覧を取得します。
     * (Criteria Query を用いた手法)
     * @return
     */
    public List&lt;Employee&gt; getEmployeeListCriteria() {
        CriteriaBuilder cb = em.getCriteriaBuilder();
        CriteriaQuery&lt;Employee&gt; criteria = cb.createQuery(Employee.class);
        Root&lt;Employee&gt; emp = criteria.from(Employee.class);
        criteria.select(emp).orderBy(cb.asc(emp.get(Employee_.shainId)));
        return em.createQuery(criteria).getResultList();
    }

    /**
     * パスワード以外の情報を更新します。
     * @param shainId
     * @param roleMaster
     * @param familyName
     * @param familyNameKana
     * @param givenName
     * @param givenNameKana
     * @param email
     * @param phoneNumber
     * @param cellphoneNumber
     * @param address
     * @param joinDate
     * @param quitDate
     * @param deleteFlag
     */
    public void updateEmployee(String shainId,
                                RoleMaster roleMaster,
                                String familyName,
                                String familyNameKana,
                                String givenName,
                                String givenNameKana,
                                String email,
                                String phoneNumber,
                                String cellphoneNumber,
                                String address,
                                Date joinDate,
                                Date quitDate,
                                Integer deleteFlag)
    {
        CriteriaBuilder cb = em.getCriteriaBuilder();
        CriteriaUpdate&lt;Employee&gt; update = cb.createCriteriaUpdate(Employee.class);
        Root&lt;Employee&gt; emp = update.from(Employee.class);
        update.set(Employee_.roleMaster, roleMaster);
        update.set(Employee_.familyName, familyName);
        update.set(Employee_.familyNameKana, familyNameKana);
        update.set(Employee_.givenName, givenName);
        update.set(Employee_.givenNameKana, givenNameKana);
        update.set(Employee_.email, email);
        update.set(Employee_.phoneNumber, phoneNumber);
        update.set(Employee_.cellphoneNumber, cellphoneNumber);
        update.set(Employee_.address, address);
        update.set(Employee_.joinDate, joinDate);
        update.set(Employee_.quitDate, quitDate);
        update.set(Employee_.deleteFlag, deleteFlag);
        update.where(cb.equal(emp.get(Employee_.shainId), shainId));
        em.createQuery(update).executeUpdate();
    }

    /**
     * パスワードの更新
     * @param shainId
     * @param password
     */
    public void updatePassword(String shainId, String password) {
        CriteriaBuilder cb = em.getCriteriaBuilder();
        CriteriaUpdate&lt;Employee&gt; update = cb.createCriteriaUpdate(Employee.class);
        Root&lt;Employee&gt; emp = update.from(Employee.class);
        update.set(Employee_.password, password);
        update.where(cb.equal(emp.get(Employee_.shainId), shainId));
        em.createQuery(update).executeUpdate();
    }
}
</pre></div>
</div>
<p id="index-0">このコードでは、DI された EntityManager を用いてデータベースへの CRUD 操作を行うメソッドを定義しています。
getEmployeeById、getEmployeeList メソッドでは、<a class="reference external" href="https://docs.oracle.com/javaee/7/tutorial/persistence-querylanguage.htm#BNBTG">JPQL</a> を用いたレコードの取得を行っています。</p>
<p>getEmployeeById メソッドではパラメータを文字列で指定して、セットする必要があります。もし文字列を書き間違えた場合、実行時までエラーは発見できません。
一方で getEmployeeByIdCriteria メソッドのように CriteriaQuery を用いると Employee_ クラスを用いて厳密にパラメータを指定でき、書き間違いはコンパイルエラーとなり間違いの発見を早めることができます。</p>
</div>
<div class="section" id="rolemasteroperation-java">
<h4>5.1.1.3. RoleMasterOperation.java の作成<a class="headerlink" href="#rolemasteroperation-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>AbstractOperation クラスと同じパッケージに RoleMasterOperation クラスを作成してください。作成後、ソースコードを以下のように修正してください。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.service;

import java.util.List;

import javax.ejb.Stateless;
import javax.persistence.Query;

import com.javadera.shainweb.model.RoleMaster;

@Stateless
public class RoleMasterOperation extends AbstractOperation {

    private final String USER = &quot;USER&quot;;
    private final String ADMIN = &quot;ADMIN&quot;;

    /**
     * RoleMaster を挿入します。
     * @param roleMaster
     */
    public void addRoleMaster(RoleMaster roleMaster) {
        em.persist(roleMaster);
    }

    /**
     * RoleMaster を削除します。
     * @param roleMaster
     */
    public void removeRoleMaster(RoleMaster roleMaster) {
        RoleMaster target = em.merge(roleMaster);
        em.remove(target);
    }

    /**
     * RoleMaster を更新します。
     * @param roleMaster
     * @return
     */
    public RoleMaster updateRoleMaster(RoleMaster roleMaster) {
        RoleMaster target = em.merge(roleMaster);
        em.flush();
        return target;
    }

    /**
     * RoleMaster 一覧を ID 順に取得する
     * @return
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public List&lt;RoleMaster&gt; getAll() {
        Query q = em.createNamedQuery(&quot;RoleMaster.findAllOrderById&quot;);
        return (List&lt;RoleMaster&gt;)q.getResultList();
    }

    /**
     * RoleMaster を Role 名を指定して取得する
     * @param name
     * @return
     */
    public RoleMaster getByName(String name) {
        Query q = em.createNamedQuery(&quot;RoleMaster.findByName&quot;);
        q.setParameter(&quot;roleName&quot;, name);
        return (RoleMaster)q.getSingleResult();
    }

    /**
     * USER ロールのレコードを取得します。
     * @return
     */
    public RoleMaster getUserRole() {
        return getByName(USER);
    }

    /**
     * Admin ロールのレコードを取得します。
     * @return
     */
    public RoleMaster getAdminRole() {
        return getByName(ADMIN);
    }
}
</pre></div>
</div>
</div>
<div class="section" id="resources-java">
<h4>5.1.1.4. Resources.java の作成<a class="headerlink" href="#resources-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>com.javadera.shainweb.util パッケージ配下に SHA256Encoder.java クラスを新規作成してください。
SHA256Encoder クラスを開き、内容を以下のように編集して保存します。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.util;

import java.util.logging.Logger;

import javax.enterprise.context.RequestScoped;
import javax.enterprise.inject.Produces;
import javax.enterprise.inject.spi.InjectionPoint;
import javax.faces.context.FacesContext;

/**
 * CDI beans
 */
public class Resources {

    @Produces
    public Logger produceLog(InjectionPoint injectionPoint) {
        return Logger.getLogger(injectionPoint.getMember().getDeclaringClass().getName());
    }

    @Produces
    @RequestScoped
    public FacesContext produceFacesContext() {
        return FacesContext.getCurrentInstance();
    }

}
</pre></div>
</div>
</div>
<div class="section" id="sha256encoder-java">
<h4>5.1.1.5. SHA256Encoder.java の作成<a class="headerlink" href="#sha256encoder-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Apache commons-codec のライブラリを使用するために追記します。
pom.xml を開き、primefaces のタグを追加した部分と同じレベルで、以下を追記して保存してください。</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;dependency&gt;
 &lt;groupId&gt;commons-codec&lt;/groupId&gt;
 &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
 &lt;version&gt;1.10&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>
</div>
<p>com.javadera.shainweb.util パッケージ配下に SHA256Encoder.java クラスを新規作成してください。
SHA256Encoder クラスを開き、内容を以下のように編集して保存します。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.util;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

import org.apache.commons.codec.binary.Base64;

public class SHA256Encoder {

    /**
     * SHA-256 でハッシュ値を計算後、Base64 でエンコードした文字列を取得します。
     * @param origPassword
     * @return
     */
    public static String getBase64EncodedPassword(String origPassword) {
        String returnValue = &quot;&quot;;
        try {
            MessageDigest md = MessageDigest.getInstance(&quot;SHA-256&quot;);
            byte[] digest = md.digest(origPassword.getBytes());
            returnValue = Base64.encodeBase64String(digest).replaceAll(&quot;\r\n&quot;, &quot;&quot;);
        } catch (NoSuchAlgorithmException e) {
        }
        return returnValue;
    }

}
</pre></div>
</div>
</div>
<div class="section" id="abstractcontroller-java">
<h4>5.1.1.6. AbstractController.java の作成<a class="headerlink" href="#abstractcontroller-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>com.javadera.shainweb.controller パッケージ配下に AbstractController.java クラスを新規作成してください。
AbstractController クラスを開き、内容を以下のように編集して保存します。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.controller;

import java.util.ArrayList;
import java.util.List;
import java.util.logging.Logger;

import javax.inject.Inject;

import com.javadera.shainweb.model.Employee;
import com.javadera.shainweb.model.RoleMaster;
import com.javadera.shainweb.service.EmployeeOperation;
import com.javadera.shainweb.service.RoleMasterOperation;

/**
 * コントローラの基底クラス
 * @author
 *
 */
public abstract class AbstractController {
    @Inject protected EmployeeOperation empOpe;
    @Inject protected RoleMasterOperation roleOpe;
    @Inject protected Logger log;

    protected Employee emp = new Employee();
    protected List&lt;RoleMaster&gt; roleList = new ArrayList&lt;&gt;();
    protected List&lt;Employee&gt; empList = new ArrayList&lt;&gt;();

    public void init() {
        roleList= roleOpe.getAll();
        empList = empOpe.getEmployeeList();
    }

    /**
     * PSQLException メッセージを取得します。
     * (DB が替わると使えない。もっとスマートな方法がある？)
     * @param caused
     * @return
     */
    protected String getPSQLExceptionLocalizedMessage(Throwable caused) {
        Throwable th = caused.getCause();
        if (th.toString().contains(&quot;PSQLException&quot;)) {
            return th.getLocalizedMessage();
        }
        else {
            return getPSQLExceptionLocalizedMessage(th);
        }
    }

    //--- getter, setter ---
    public List&lt;Employee&gt; getEmpList() {
        return empList;
    }

    public void setEmpList(List&lt;Employee&gt; empList) {
        this.empList = empList;
    }

    public Employee getEmp() {
        return emp;
    }

    public void setEmp(Employee emp) {
        this.emp = emp;
    }

    public List&lt;RoleMaster&gt; getRoleList() {
        return roleList;
    }

    public void setRoleList(List&lt;RoleMaster&gt; roleList) {
        this.roleList = roleList;
    }

}
</pre></div>
</div>
</div>
<div class="section" id="shaindata-java">
<h4>5.1.1.7. ShainData.java の作成<a class="headerlink" href="#shaindata-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>com.javadera.shainweb.controller パッケージ配下に ShainData.java クラスを新規作成してください。
ShainData クラスを開き、内容を以下のように編集して保存します。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.controller;

import java.io.Serializable;

import javax.annotation.PostConstruct;
import javax.enterprise.context.SessionScoped;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import javax.inject.Named;

import com.javadera.shainweb.model.Employee;
import com.javadera.shainweb.model.RoleMaster;
import com.javadera.shainweb.util.SHA256Encoder;

@Named
@SessionScoped
public class ShainData extends AbstractController implements Serializable {

    private static final long serialVersionUID = 1L;
    private String roleString = &quot;&quot;;
    private boolean newStaff = false;
    private String buttonCaption = &quot;&quot;;

    @PostConstruct
    public void init() {
        super.init();
    }

    /**
     * 新規追加画面に遷移します。
     * @return
     */
    public String addEmp() {
        this.emp = new Employee();
        newStaff = true;
        roleString = &quot;USER&quot;;
        buttonCaption = &quot;追加&quot;;
        return &quot;shainData.xhtml&quot;;
    }

    /**
     * 社員情報編集画面に遷移します。
     * @param emp
     * @return
     */
    public String editEmp(Employee emp) {
        this.emp = emp;
        newStaff = false;
        roleString = this.emp.getRoleMaster().getRoleName();
        buttonCaption = &quot;更新&quot;;
        return &quot;shainData.xhtml&quot;;
    }

    /**
     * 社員情報を追加/更新します。
     * @return
     */
    public String executeEmp() {
        RoleMaster role = roleOpe.getByName(roleString);
        emp.setRoleMaster(role);
        emp.setDeleteFlag(0);
        try {
            if (newStaff) {
                // 初回登録時は固定のパスワードを設定しておく
                emp.setPassword(SHA256Encoder.getBase64EncodedPassword(&quot;password#!&quot;));
                empOpe.addEmployee(emp);
            }
            else {
                empOpe.updateEmployee(emp.getShainId(),
                        emp.getRoleMaster(),
                        emp.getFamilyName(),emp.getFamilyNameKana(),
                        emp.getGivenName(), emp.getGivenNameKana(),
                        emp.getEmail(),
                        emp.getPhoneNumber(), emp.getCellphoneNumber(),
                        emp.getAddress(),
                        emp.getJoinDate(),emp.getQuitDate(),
                        emp.getDeleteFlag());
            }
        }
        catch (Exception ex) {
            String errorMessage = getPSQLExceptionLocalizedMessage(ex.getCause());
            FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_FATAL, &quot;エラー&quot;, errorMessage));
            return &quot;&quot;;
        }
        return &quot;shainList.xhtml&quot;;
    }

    //--- getter, setter ---
    public String getButtonCaption() {
        return buttonCaption;
    }

    public void setButtonCaption(String buttonCaption) {
        this.buttonCaption = buttonCaption;
    }

    public String getRoleString() {
        return roleString;
    }

    public void setRoleString(String roleString) {
        this.roleString = roleString;
    }

    public boolean isNewStaff() {
        return newStaff;
    }

    public void setNewStaff(boolean newStaff) {
        this.newStaff = newStaff;
    }

}
</pre></div>
</div>
</div>
<div class="section" id="shainpassword-java">
<h4>5.1.1.8. ShainPassword.java の作成<a class="headerlink" href="#shainpassword-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>com.javadera.shainweb.controller パッケージ配下に ShainPassword.java クラスを新規作成してください。
ShainPassword クラスを開き、内容を以下のように編集して保存します。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.controller;

import java.io.Serializable;

import javax.annotation.PostConstruct;
import javax.enterprise.context.SessionScoped;
import javax.inject.Named;

import com.javadera.shainweb.model.Employee;
import com.javadera.shainweb.util.SHA256Encoder;

@Named
@SessionScoped
public class ShainPassword extends AbstractController implements Serializable {

    private static final long serialVersionUID = 1L;
    private String newPassword = &quot;&quot;;

    @PostConstruct
    public void init() {
        super.init();
    }

    /**
     * パスワード更新画面を表示します。
     * @param emp
     * @return
     */
    public String changePassword(Employee emp) {
        this.emp = emp;
        return &quot;shainPassword.xhtml&quot;;
    }

    /**
     * パスワードを更新します。
     * @return
     */
    public String updatePassword() {
        String encodedPassword = SHA256Encoder.getBase64EncodedPassword(newPassword);
        empOpe.updatePassword(emp.getShainId(), encodedPassword);
        return &quot;shainList.xhtml&quot;;
    }

    //--- getter, setter ---
    public String getNewPassword() {
        return newPassword;
    }

    public void setNewPassword(String newPassword) {
        this.newPassword = newPassword;
    }
}
</pre></div>
</div>
</div>
<div class="section" id="shaindata-xhtml">
<h4>5.1.1.9. 社員データ編集画面 (shainData.xhtml) の作成<a class="headerlink" href="#shaindata-xhtml" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>社員データ編集画面 (shainData.xhtml) を追加します。shainList.xhtml と同じ場所に shainData.xhtml を作成してください。作成後、ソースコードを以下のように修正してください。</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;ui:composition xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
      xmlns:ui=&quot;http://java.sun.com/jsf/facelets&quot;
      xmlns:f=&quot;http://java.sun.com/jsf/core&quot;
      xmlns:h=&quot;http://java.sun.com/jsf/html&quot;
      xmlns:p=&quot;http://primefaces.org/ui&quot;
      xmlns:c=&quot;http://java.sun.com/jsp/jstl/core&quot;
      template=&quot;/WEB-INF/template.xhtml&quot;&gt;

        &lt;ui:define name=&quot;content&quot;&gt;
            &lt;p:panelGrid id=&quot;shainDataPanelGridId&quot; columns=&quot;3&quot;&gt;
                &lt;h:outputLabel for=&quot;shainIdInputTextId&quot; value=&quot;社員 ID&quot; /&gt;
                &lt;p:inputText    id=&quot;shainIdInputTextId&quot; disabled=&quot;#{shainData.newStaff == false}&quot; value=&quot;#{shainData.emp.shainId}&quot;/&gt;
                &lt;p:message     for=&quot;shainIdInputTextId&quot;/&gt;

                &lt;p:outputLabel for=&quot;seiInputTextId&quot; value=&quot;姓&quot; /&gt;
                &lt;p:inputText id=&quot;seiInputTextId&quot; value=&quot;#{shainData.emp.familyName}&quot;/&gt;
                &lt;p:message for=&quot;seiInputTextId&quot; /&gt;

                &lt;p:outputLabel for=&quot;seiKanaInputTextId&quot; value=&quot;姓(カナ)&quot; /&gt;
                &lt;p:inputText id=&quot;seiKanaInputTextId&quot; value=&quot;#{shainData.emp.familyNameKana}&quot;/&gt;
                &lt;p:message for=&quot;seiKanaInputTextId&quot; /&gt;

                &lt;p:outputLabel for=&quot;meiInputTextId&quot; value=&quot;名&quot; /&gt;
                &lt;p:inputText id=&quot;meiInputTextId&quot; value=&quot;#{shainData.emp.givenName}&quot;/&gt;
                &lt;p:message for=&quot;meiInputTextId&quot; /&gt;

                &lt;p:outputLabel for=&quot;meiKanaInputTextId&quot; value=&quot;名(カナ)&quot; /&gt;
                &lt;p:inputText id=&quot;meiKanaInputTextId&quot; value=&quot;#{shainData.emp.givenNameKana}&quot;/&gt;
                &lt;p:message for=&quot;meiKanaInputTextId&quot; /&gt;

                &lt;p:outputLabel value=&quot;メールアドレス&quot; /&gt;
                &lt;p:inputText id=&quot;mailAddressInputTextId&quot; value=&quot;#{shainData.emp.email}&quot;/&gt;
                &lt;p:message for=&quot;mailAddressInputTextId&quot; /&gt;

                &lt;p:outputLabel for=&quot;roleSelectOneRadioId&quot; value=&quot;ロール&quot; /&gt;
                &lt;p:selectOneRadio id=&quot;roleSelectOneRadioId&quot; value=&quot;#{shainData.roleString}&quot;&gt;
                    &lt;f:selectItems value=&quot;#{shainData.roleList}&quot; var=&quot;r&quot; itemLabel=&quot;#{r.roleName}&quot; itemValue=&quot;#{r.roleName}&quot;/&gt;
                &lt;/p:selectOneRadio&gt;
                &lt;p:message for=&quot;roleSelectOneRadioId&quot; /&gt;

                &lt;p:outputLabel for=&quot;phoneInputTextId&quot; value=&quot;電話番号(固定)&quot; /&gt;
                &lt;p:inputText id=&quot;phoneInputTextId&quot; value=&quot;#{shainData.emp.phoneNumber}&quot;/&gt;
                &lt;p:message for=&quot;phoneInputTextId&quot; /&gt;

                &lt;p:outputLabel for=&quot;cellPhoneInputTextId&quot; value=&quot;電話番号(携帯)&quot; /&gt;
                &lt;p:inputText id=&quot;cellPhoneInputTextId&quot; value=&quot;#{shainData.emp.cellphoneNumber}&quot;/&gt;
                &lt;p:message for=&quot;cellPhoneInputTextId&quot; /&gt;

                &lt;p:outputLabel for=&quot;addressInputTextAreaId&quot; value=&quot;住所&quot; /&gt;
                &lt;p:inputTextarea id=&quot;addressInputTextAreaId&quot; rows=&quot;5&quot; cols=&quot;30&quot; maxlength=&quot;300&quot; value=&quot;#{shainData.emp.address}&quot;/&gt;
                &lt;p:message for=&quot;addressInputTextAreaId&quot; /&gt;

                &lt;p:outputLabel for=&quot;joinDateCalendarId&quot; value=&quot;入社日&quot; /&gt;
                &lt;p:calendar id=&quot;joinDateCalendarId&quot; value=&quot;#{shainData.emp.joinDate}&quot; pattern=&quot;yyyy/MM/dd&quot;/&gt;
                &lt;p:message for=&quot;joinDateCalendarId&quot; /&gt;

                &lt;p:outputLabel for=&quot;quitDateCalendarId&quot; value=&quot;退社日&quot; /&gt;
                &lt;p:calendar id=&quot;quitDateCalendarId&quot; value=&quot;#{shainData.emp.quitDate}&quot; pattern=&quot;yyyy/MM/dd&quot; /&gt;
                &lt;p:message for=&quot;quitDateCalendarId&quot; /&gt;
            &lt;/p:panelGrid&gt;
            &lt;p:messages id=&quot;shainDataMessages&quot; showDetail=&quot;true&quot; autoUpdate=&quot;true&quot; closable=&quot;true&quot;/&gt;
            &lt;p:commandButton id=&quot;showConfirmButtonId&quot; value=&quot;#{shainData.buttonCaption}&quot; action=&quot;#{shainData.executeEmp}&quot; update=&quot;shainDataPanelGridId&quot;/&gt;
            &lt;p:button id=&quot;cancelAddEditButtonId&quot; value=&quot;キャンセル&quot; outcome=&quot;shainList&quot;/&gt;
        &lt;/ui:define&gt;
&lt;/ui:composition&gt;
</pre></div>
</div>
</div>
<div class="section" id="shainpassword-xhtml">
<h4>5.1.1.10. 社員パスワード変更画面 (shainPassword.xhtml) の作成<a class="headerlink" href="#shainpassword-xhtml" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>社員パスワード変更画面 (shainPassword.xhtml) を追加します。shainList.xhtml と同じ場所に shainPassword.xhtml を作成してください。作成後、ソースコードを以下のように修正してください。</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;ui:composition xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
      xmlns:ui=&quot;http://java.sun.com/jsf/facelets&quot;
      xmlns:f=&quot;http://java.sun.com/jsf/core&quot;
      xmlns:h=&quot;http://java.sun.com/jsf/html&quot;
      xmlns:p=&quot;http://primefaces.org/ui&quot;
      xmlns:c=&quot;http://java.sun.com/jsp/jstl/core&quot;
      template=&quot;/WEB-INF/template.xhtml&quot;&gt;

        &lt;ui:define name=&quot;content&quot;&gt;
            &lt;h:outputText value=&quot;#{shainPassword.emp.familyName} #{shainPassword.emp.givenName} (#{shainPassword.emp.familyNameKana} #{shainPassword.emp.givenNameKana}) さんのパスワードを変更します。&quot; /&gt;
            &lt;p:panelGrid id=&quot;shainDataPasswordChangePanelGridId&quot; columns=&quot;2&quot;&gt;
                &lt;p:outputLabel for=&quot;newPasswordInputTextId&quot; value=&quot;新しいパスワード&quot; /&gt;
                &lt;p:password id=&quot;newPasswordInputTextId&quot; value=&quot;#{shainPassword.newPassword}&quot; match=&quot;confirmPasswordInputTextId&quot; feedback=&quot;true&quot; promptLabel=&quot;入力して下さい&quot; weakLabel=&quot;パスワード強度：弱い&quot; goodLabel=&quot;パスワード強度：普通&quot; strongLabel=&quot;パスワード強度：強い&quot; required=&quot;true&quot; /&gt;

                &lt;p:outputLabel for=&quot;confirmPasswordInputTextId&quot; value=&quot;新しいパスワード(確認)&quot; /&gt;
                &lt;p:password id=&quot;confirmPasswordInputTextId&quot; value=&quot;#{shainPassword.newPassword}&quot; required=&quot;true&quot; /&gt;
            &lt;/p:panelGrid&gt;
            &lt;p:messages id=&quot;passwordMessages&quot; showDetail=&quot;true&quot; autoUpdate=&quot;true&quot; closable=&quot;true&quot; /&gt;
            &lt;p:commandButton id=&quot;passwordChangeExecuteButtonId&quot; value=&quot;更新&quot; action=&quot;#{shainPassword.updatePassword}&quot;/&gt;
            &lt;p:button id=&quot;passwordChangeCanncelButtonId&quot; value=&quot;キャンセル&quot; outcome=&quot;shainList&quot;/&gt;
        &lt;/ui:define&gt;
&lt;/ui:composition&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>5.1.2. 修正するソースコード<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>次に既存のソースコードを修正します。</p>
<ul class="simple">
<li>shainList.xhtml</li>
<li>ShainList.java</li>
<li>Employee.java</li>
</ul>
<div class="section" id="shainlist-xhtml">
<h4>5.1.2.1. 社員一覧画面 (shainList.xhtml) の修正<a class="headerlink" href="#shainlist-xhtml" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>ソースコードを以下のように修正してください。</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;ui:composition xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
      xmlns:ui=&quot;http://java.sun.com/jsf/facelets&quot;
      xmlns:f=&quot;http://java.sun.com/jsf/core&quot;
      xmlns:h=&quot;http://java.sun.com/jsf/html&quot;
      xmlns:p=&quot;http://primefaces.org/ui&quot;
      template=&quot;/WEB-INF/template.xhtml&quot;&gt;

        &lt;ui:define name=&quot;content&quot;&gt;
            &lt;table&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;p:commandButton id=&quot;addNewShainButtonId&quot; action=&quot;#{shainData.addEmp}&quot; value=&quot;新規追加&quot; /&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;
                        &lt;p:dataTable id=&quot;shainListDataTableId&quot; var=&quot;e&quot; value=&quot;#{shainList.empList}&quot; emptyMessage=&quot;社員は存在しません。&quot;&gt;
                            &lt;p:column headerText=&quot;社員番号&quot; style=&quot;width:60px&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.shainId}&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;氏名 (カナ)&quot; style=&quot;width:200px&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.familyName} #{e.givenName} (#{e.familyNameKana} #{e.givenNameKana})&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;メールアドレス&quot; style=&quot;width:150px&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.email}&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;電話番号 (携帯)&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.phoneNumber} (#{e.cellphoneNumber})&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;住所&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.address}&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;入社日&quot; style=&quot;width:80px&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.joinDate}&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;退社日&quot; style=&quot;width:80px&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.quitDate}&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;ロール&quot; style=&quot;width:50px&quot;&gt;
                                &lt;h:outputText value=&quot;#{e.roleMaster.roleName}&quot;/&gt;
                            &lt;/p:column&gt;

                            &lt;p:column headerText=&quot;編集/削除&quot;&gt;
                                &lt;p:commandButton id=&quot;editEmpButtonId&quot; action=&quot;#{shainData.editEmp(e)}&quot; icon=&quot;ui-icon-wrench&quot; title=&quot;更新&quot;/&gt;
                                &lt;p:commandButton id=&quot;changePasswordEmpButtonId&quot; action=&quot;#{shainPassword.changePassword(e)}&quot; icon=&quot;ui-icon-locked&quot; title=&quot;パスワード更新&quot;/&gt;
                                &lt;p:commandButton id=&quot;deleteEmpButtonId&quot; update=&quot;shainListDataTableId&quot; actionListener=&quot;#{shainList.deleteEmp(e)}&quot; onclick=&quot;return confirm(&#39;本当に削除しますか？&#39;)&quot; icon=&quot;ui-icon-trash&quot; title=&quot;削除&quot;/&gt;
                            &lt;/p:column&gt;
                        &lt;/p:dataTable&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/ui:define&gt;
&lt;/ui:composition&gt;
</pre></div>
</div>
</div>
<div class="section" id="shainlist-java">
<h4>5.1.2.2. ShainList.java の修正<a class="headerlink" href="#shainlist-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下の点を修正します。</p>
<ul class="simple">
<li>ViewScoped に変更</li>
<li>init メソッドの中身を修正</li>
<li>deleteEmp メソッドを追加</li>
<li>createEmp, serveResponse を削除</li>
</ul>
<p>以下のように修正してください。</p>
<div class="highlight-python"><div class="highlight"><pre>package com.javadera.shainweb.controller;

import java.io.Serializable;

import javax.annotation.PostConstruct;
import javax.faces.bean.ViewScoped;
import javax.inject.Named;

import com.javadera.shainweb.model.Employee;

@Named
@ViewScoped
public class ShainList extends AbstractController implements Serializable {

    private static final long serialVersionUID = 1L;

    @PostConstruct
    public void init() {
        super.init();
    }

    /**
     * 社員情報を論理削除します。
     * @param emp
     * @return
     */
    public String deleteEmp(Employee emp) {
        this.emp = emp;
        // DeleteFlag を設定してレコード更新
        emp.setDeleteFlag(1);
        empOpe.updateEmployee(emp);
        empList = empOpe.getEmployeeList();
        return &quot;shainList.xhtml&quot;;
    }
}
</pre></div>
</div>
</div>
<div class="section" id="employee-java">
<span id="employeejavaedit"></span><h4>5.1.2.3. Employee.java の修正<a class="headerlink" href="#employee-java" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>以下の点を修正します。</p>
<ul class="simple">
<li>NamedQueries, NamedQuery アノテーションの追加</li>
</ul>
<p>変更点のみを以下に示します。</p>
<p id="index-1">NamedQueries, NamedQuery アノテーションを追加します。これにより JPQL を用いたデータ取得が可能になります。
さらに getRoleMaster の FetchType を <strong>LAZY</strong> から <strong>EAGER</strong> に変更します。</p>
<p><strong>Employee.java</strong></p>
<div class="highlight-python"><div class="highlight"><pre>@Entity
@Table(name = &quot;employee&quot;, uniqueConstraints = @UniqueConstraint(columnNames = &quot;email&quot;) )
@NamedQueries({
    @NamedQuery(name=&quot;Employee.findAllOrderById&quot;, query=&quot;SELECT e FROM Employee e WHERE e.deleteFlag = 0 ORDER BY e.shainId&quot;),
    @NamedQuery(name=&quot;Employee.findById&quot;,         query=&quot;SELECT e FROM Employee e WHERE e.shainId = :shainId&quot;)
})
public class Employee implements java.io.Serializable {

...(中略)...

    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = &quot;role_id&quot;, nullable = false)
    public RoleMaster getRoleMaster() {
        return this.roleMaster;
    }

...(後略)...

}
</pre></div>
</div>
<p><strong>RoleMaster.java</strong></p>
<p>同様に NamedQuery を追加します。</p>
<div class="highlight-python"><div class="highlight"><pre>@Entity
@Table(name = &quot;role_master&quot;, uniqueConstraints = @UniqueConstraint(columnNames = &quot;role_name&quot;) )
@NamedQueries({
    @NamedQuery(name=&quot;RoleMaster.findAllOrderById&quot;, query=&quot;SELECT rm FROM RoleMaster rm ORDER BY rm.roleId&quot;),
    @NamedQuery(name=&quot;RoleMaster.findByName&quot;,       query=&quot;SELECT rm FROM RoleMaster rm WHERE rm.roleId = :roleId&quot;)
})
public class RoleMaster implements java.io.Serializable { ...(後略)
</pre></div>
</div>
<p>この状態でデバッグ実行してください。データベースから社員一覧を取得し、その結果を表示します。
現時点ではデータが入っていないので、「社員は存在しません。」のメッセージが表示されます。</p>
<img alt="_images/01_emptyList.png" src="_images/01_emptyList.png" />
</div>
</div>
</div>
<div class="section" id="id4">
<h2>5.2. データの挿入<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>社員一覧画面で「新規追加」ボタンを押下して、社員データ画面に遷移します。
空欄に情報を入力してください。便宜上「退社日」は 9999/12/31 を入力してください。</p>
<a class="reference internal image-reference" href="_images/02_shainData_namae1.png"><img alt="_images/02_shainData_namae1.png" src="_images/02_shainData_namae1.png" style="width: 328.2px; height: 366.6px;" /></a>
<p>入力後「追加」ボタンを押下します。社員一覧画面に遷移し、表にデータが表示されます。</p>
<a class="reference internal image-reference" href="_images/03_shainAdded.png"><img alt="_images/03_shainAdded.png" src="_images/03_shainAdded.png" style="width: 794.4px; height: 150.6px;" /></a>
<p>pgAdmin でデータが追加されていることもチェックできます。</p>
<a class="reference internal image-reference" href="_images/04_pgAdminData.png"><img alt="_images/04_pgAdminData.png" src="_images/04_pgAdminData.png" style="width: 713.4px; height: 37.2px;" /></a>
<p>データの追加は EntityManager の persist メソッドに対して Entity クラスのインスタンスを引数に渡すだけで実行できます。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">新規作成時にパスワードは &#8220;password#!&#8221; の固定文字列を暗号化したもので統一してあります。</p>
</div>
</div>
<div class="section" id="id5">
<h2>5.3. データの更新<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>社員一覧画面の「編集/削除」にあるスパナのアイコンが付いているボタンを押下します。
社員 ID 欄が追加された社員データ画面が表示されます。</p>
<a class="reference internal image-reference" href="_images/05_shainData_edit.png"><img alt="_images/05_shainData_edit.png" src="_images/05_shainData_edit.png" style="width: 329.4px; height: 366.0px;" /></a>
<p>表示された情報を編集し、「更新」ボタンを押下すると社員一覧画面に遷移し、表に更新後のデータが表示されます。</p>
<a class="reference internal image-reference" href="_images/06_shainData_editDone.png"><img alt="_images/06_shainData_editDone.png" src="_images/06_shainData_editDone.png" style="width: 793.8px; height: 175.8px;" /></a>
<p>データの編集は EntityManager の merge メソッドで、Entity クラスのインスタンスを EntityManager の管理下に置き、そのインスタンスを flush メソッドによりデータベースに書き込むことにより実行します。</p>
<p>新規挿入時に固定文字列で設定したパスワードは、カギのアイコンが付いているボタンを押下することにより変更できます。</p>
<a class="reference internal image-reference" href="_images/06_01_shainPassword_edit.png"><img alt="_images/06_01_shainPassword_edit.png" src="_images/06_01_shainPassword_edit.png" style="width: 479.2px; height: 241.6px;" /></a>
</div>
<div class="section" id="id6">
<h2>5.4. データの削除<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>社員一覧画面の「編集/削除」にあるゴミ箱のアイコンが付いているボタンを押下します。
Javascript のダイアログが表示され、本当に削除を実行するか否かの確認画面が表示されます。</p>
<a class="reference internal image-reference" href="_images/09_deleteConfirmDialog.png"><img alt="_images/09_deleteConfirmDialog.png" src="_images/09_deleteConfirmDialog.png" style="width: 793.8px; height: 175.2px;" /></a>
<p>「OK」ボタンの押下で論理削除が実行されます。社員一覧画面から対象データが削除されます。</p>
<a class="reference internal image-reference" href="_images/10_shainList_deleted.png"><img alt="_images/10_shainList_deleted.png" src="_images/10_shainList_deleted.png" style="width: 795.6px; height: 151.8px;" /></a>
<p>pgAdmin でデータが論理削除されていることもチェックできます。</p>
<img alt="_images/11_logicalDeleted.png" src="_images/11_logicalDeleted.png" />
<p>データの削除は、データ更新時と同様に EntityManager の管理下に置いた状態で remove メソッドを呼び出して実行します。</p>
</div>
<div class="section" id="id7">
<h2>5.5. まとめ<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ol class="arabic simple">
<li>データの CRUD は EntityManager を用いて行う。</li>
<li>更新と削除は、EntityManager の merge メソッドで、対象インスタンスを EntityManager の管理下に置いてから行う。</li>
</ol>
</div>
<div class="section" id="id8">
<h2>5.6. 確認してください<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul>
<li><p class="first">JSF</p>
<blockquote>
<div><ul>
<li><div class="first line-block">
<div class="line">ShainData.java は SessionScoped を、ShainList.java は ViewScoped を使用しています。</div>
<div class="line">両者と RequestScoped の違いを調べてください。</div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">JPA</p>
<blockquote>
<div><ul class="simple">
<li>レコードの物理削除を試してみてください。</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="06_Validation.html" title="6. データバリデーション"
             >次へ</a> |</li>
        <li class="right" >
          <a href="04_JSF.html" title="4. JSF を用いた画面表示"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">WebAppTraining 1.0 ドキュメント</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Wing Education Group.
      このドキュメントは <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1 で生成しました。
    </div>
<script type="text/javascript">
<!--
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76729087-1', 'auto');
  ga('send', 'pageview');
-->
</script>
<meta name="description" itemprop="description" content="これからJavaEEを始めたいというエンジニア向けの入門書です。Wildfly、Eclipse、データベースを使い、社員データを管理するJavaEEアプリケーションを構築します。" />
<meta name="keywords" itemprop="keywords" content="Java,寺子屋,寺小屋,Java,ダウンロード,インストール,JavaEE,JavaSE,JSF,EJB,CDI,JPA,認証,Primefaces,Eclipse,Wildfly,Postgresql,入門,はじめて,初心者,ジャバ" />

  </body>
</html>